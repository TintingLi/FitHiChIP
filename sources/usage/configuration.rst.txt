Setting up configuration file
===============================

As mentioned in the Quick Start module, FitHiChIP is executed by typing the following command in a bash terminal (assuming the executable is in current directory):

	sh FitHiChIP_HiCPro.sh -C configuration_file_name

Here we mention the parameters and recommended values to be provided in the configuration file.

Each entry of the configuration file has the following format:

	Param=ParamValue

where,

	- "Param" indicates one parameter (variable)
	- "ParamValue" is the corresponding value (numeric or string format).

.. note:: 
	We recommend users to mention the absolute paths of files or folders in the configuration file.

A) Input File name related parameters
---------------------------------------

	A.1) ValidPairs: 
	
		- Valid pairs generated by HiC-pro pipeline (either simple text format, or can be in gzipped format). 
		- **** Note: Mandatory parameter.

	A.2) Interval: 
		
		- File depicting the bins of the interaction matrix. 
		- Size of an interval depends on the bin size. 
		- Individual bins are also assigned a distinct number. 
		- By default, this file name ends with a suffix '_abs.bed'.

	A.3) Matrix: 
		
		- File listing the number of interactions (contacts) among the bins listed in the "Interval" file.
		- The file has three columns: bin1 (first interacting bin), bin2 (second interacting bin), cc (contact counts)

		.. note::

			User may leave the fields A.2) and A.3) blank, if wishes to not pre-compute these matrices. In such a case, FitHiChIP computes the matrix from the parameter A.1.


	A.4) PeakFile: 

		- Reference ChIP-seq peak file (recommended to use standard ENCODE peaks). **Mandatory parameter.**
		- User may use pre-computed ChIP-seq peaks, or pre-computed HiChIP peaks (procedure to generate HiChIP peaks is described in the utility section).
		
		.. note::

			user may employ MACS2, or a recent package hichipper (Lareau et al 2018) to compute the peaks from HiChIP data, and provide the bed formatted peak file as an input to FitHiChIP.

	A.5) OutDir: 

		- Output directory which would contain all the results. 
		- Default: present working directory.

	A.6) HiCProBasedir: 

		- Installation directory of HiC-pro package. (example: /custom_path/HiCPro/HiC-Pro_2.9.0/) **Mandatory parameter.**

		.. note::

			This parameter is important because following two modules (scripts) from HiC-pro are directly invoked from FitHiChIP:

				1. $HiCProBasedir/scripts/build_matrix

					- Computes the inetraction matrix from the valid pairs file

				2. $HiCProBasedir/scripts/ice

					- computes the ICE bias, if ICE bias correction is enabled



B) Reference genome related parameters
---------------------------------------

	B.1) ChrSizeFile: 

		- File having the reference chromosome size. 
		- Default: chrom_hg19.sizes (already provided within the TestData folder).

	B.2) RefFasta: 

		- Fasta formatted sequence of the reference chromosome (such as hg19, mm9). 

		.. note::

			- This parameter is optional. Default value is blank (empty string).
			- If provided by the user (like the file hg19.fa), used to compute the mappability and GC content information (instructions for downloading this file are provided in a separate section).

	B.3) MappabilityFile: 

		- Reference mappability file (according to the reference genome). 

		.. note::
	
			- Optional parameter. Default value is blank (empty string).
			- If provided by the user, used to compute the mappability information. In such a case, user needs to download this file from the site: <http://hgdownload.cse.ucsc.edu/goldenPath/>
			- Should be provided in the bedgraph format. 
			- For bigWig file, user should use the following UCSC utility for converting to bedGraph format: 
				
				**BigWigToBedgraph inp.bw out.bedGraph**

	B.4) REFragFile: 

		- File containing the restriction fragment information, with respect to the reference genome and the restriction site. 

		.. note::

			- Optional parameter. Default value is blank (empty string).
			- If provided, the file format (tab delimited) is:
				
				chr \\t    interval_start  \\t	interval_end

			- The MboI restriction fragment file "MboI_hg19_RE_Fragments.bed" (most commonly used restriction fragment in various HiChIP pipelines) is provided as an example file, in the TestData folder. 
	
			- For other restriction fragment files, please refer to the HiC-Pro manual <https://github.com/nservant/HiC-Pro> to know about their generation.

	B.5) GCSize: 

		- Size of the window upstream and downstream the restriction site, for computing the GC content. 
		- Default = 200 (as per the specification in the package HiCNorm [PMID: 23023982])

		.. note::

			- This value is not used unless reference fasta sequence, mappability file, and the restriction fragment file is not provided.

	B.6) MappSize: 

		- Size of the window upstream and downstream the restriction site, to calculate the mappability information. 
		- Default = 500 (as per the specification of HiCNorm [PMID: 23023982])

		.. note::
	
			- This value is not used unless reference fasta sequence, mappability file, and the restriction fragment file is not provided.


C) Generic parameters for profiling interactions
----------------------------------------------------

	C.1) IntType: 

		Type of interaction to be computed. Options are:

		(1) peak to peak: contacts between all pairs of peak segments (subject to fixed size binning)

		(2) peak to non peak: contacts between pairs of segments such that one is a peak and the other is a non-peak segment

		(3) peak to all (default): here one interacting segment is a peak, while the other can be a peak or a non-peak. Encapsulates the options 1 and 2. This is the default setting, as HiChIP protocol is targeted to find protein centric interactions.								
		(4) all to all: Interactions between every possible pairs of segments are computed. This resembles Hi-C mode.

		(5) Everything from 1 to 4. That is, all of the above mentioned interactions are computed.

	C.2) BINSIZE: 

		Size of the bins, depicting the resolution employed. Default= 5000 (means 5 Kb resolution)

	C.3) LowDistThr: 

		Lower distance threshold of interaction between two intervals (CIS). Default: 20000 (indicates 20 Kb). Interactions below this distance threshold will not be considered for statistical significance.

	C.4) UppDistThr: 

		Upper distance threshold of interaction between two intervals (CIS). Default: 2000000 (indicates 2 Mb). Interactions above this distance threshold will not be considered for statistical significance.

	C.5) QVALUE: 

		Minimum FDR (q-value) cutoff for detecting significant interactions. Default: 0.01


D) Parameters for significant loop calling
----------------------------------------------------

	D.1) NBins: 

		Max number of equal occupancy bins employed in the FitHiC. Default: 200

		**Note: Equal occupancy binning (recommended in FitHiC) is used for contact probability estimation.**

	D.2) UseP2PBackgrnd: 

		Can be 0 or 1. Applicable only for peak to all interactions (IntType = 3).

			- 1: peak to peak background (locus pairs) are used for contact probability estimation. Refers to FitHiChIP(S)
			- 0: peak to all background (locus pairs) are used for contact probability estimation. Refers to FitHiChIP(L)

			.. note::

				We recommend users to check FitHiChIP output for both settings. Specifically, for low to moderate sequencing depth, use 0, whereas for very high sequencing depth, employ a value 1.


E) Bias correction related parameters
----------------------------------------------------

	E.1) BiasCorrection: 

		- Indicates if the bias correction is enabled (1) or not (0). 
		- Default 1 (we recommend as MUST).

		.. note::

			User should enable the bias correction, since without bias correction, many false positive interactions are reported.

	E.2) BiasType: 

		Can be 1 or 2. This parameter signifies the type of bias correction used. 

			- A value of 1 means that coverage specific bias is used (default). 
			- Value of 2 means that ICE specific bias is computed. 

			.. note::

				Results in the manuscript employ BiasType=1


F) Merging adjacent interactions
----------------------------------------------------

	F.1) MergeInt: 

		- Has the value 0 or 1. 
		- If 1, merge filtering (+M) is enabled. Otherwise (0) not.
		- **We recommend setting this value as 1.**

G) Miscellaneous parameters
----------------------------------------------------

	G.1) PREFIX: 

		Prefix string used before any output file name. Default = "FitHiChIP"

	G.2) Draw: 

		A binary variable (1/0). If 1, draws various statistical and analysis plots. Default 0.

	G.3) TimeProf: 

		A binary variable (1/0). If 1, logs the time elapsed during individual steps. Default 0.

	G.4) OverWrite: 

		A binary variable (1/0). 

			- If 1, overwrites existing FitHiChIP output files. 
			- Otherwise (0) skips re-computation of existing outputs.


			

























